#!/usr/bin/env bash

# Convert svg to png 
#
# jontas@gmx.com (2025)
# SPDX-License-Identifier: MIT

# Standard screen resolution
DPI="96"

# Check if Inkscape is installed
if ! command -v inkscape &> /dev/null
then
    echo "Inkscape not installed"
    exit 1
fi

echo "Starting recursive conversion of SVG to PNG with a transparent background..."
echo "Files that already have a corresponding PNG will be skipped."
echo "--------------------------------------------------------"

find . -type f -name "*.svg" -print0 | while IFS= read -r -d $'\0' svg_file; do
    png_file="${svg_file%.svg}.png"
    
    if [ -f "$png_file" ]; then
        echo "Skipping: $svg_file (PNG already exists: $png_file)"
        continue # Skip to the next SVG file
    fi
    
    echo "Converting: $svg_file -> $png_file"
    
    # Execute the Inkscape command
    inkscape --export-filename="$png_file" \
             --export-type="png" \
             --export-background-opacity="0" \
             --export-dpi="$DPI" \
             "$svg_file"
    
    # Check the exit status of the previous command ($?)
    if [ $? -eq 0 ]; then
        echo "Success!"
    else
        echo "ERROR: Conversion failed for $svg_file."
    fi
    echo "--------------------------------------------------------"
done

echo "Done. All .svg files have been processed recursively."

